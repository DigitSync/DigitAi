<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Exam Master - Assam Competitive Focus</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom Styles for better aesthetics and full-screen compatibility */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Light gray background */
            color: #1f2937; /* Dark text */
        }
        /* Full-screen overlay for anti-cheating mode */
        #app-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: #f0f4f8;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            z-index: 9999;
        }
        /* Custom button styling */
        .btn-primary {
            background-image: linear-gradient(to right, #4f46e5, #6366f1, #818cf8);
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
        .btn-primary:hover {
            box-shadow: 0 10px 15px -3px rgba(99, 102, 241, 0.5), 0 4px 6px -4px rgba(99, 102, 241, 0.5);
            transform: translateY(-2px);
        }

        /* Certificate Styling */
        .certificate {
            background: linear-gradient(135deg, #ffffff, #f0f4f8);
            border: 10px solid #fbbf24; /* Yellow border for prestige */
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            max-width: 800px;
            margin: 20px auto;
            text-align: center;
        }
        .cert-header { color: #4f46e5; font-size: 2.5rem; font-weight: 700; border-bottom: 2px solid #4f46e5; padding-bottom: 10px; margin-bottom: 20px; }
        .cert-name { font-size: 2rem; color: #1f2937; margin: 15px 0; font-weight: 600; }
        .cert-score { font-size: 1.5rem; color: #10b981; font-weight: 700; margin-top: 10px; }
        .cert-footer { margin-top: 40px; border-top: 1px solid #d1d5db; padding-top: 15px; font-size: 0.9rem; color: #6b7280; }
        
        /* Loading Spinner */
        .spinner {
            border: 8px solid #f3f3f3;
            border-top: 8px solid #6366f1;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>

<div id="app-container" class="p-4 sm:p-8">
    <header class="text-center mb-6 pt-4">
        <h1 class="text-3xl font-bold text-gray-800">ðŸŽ¯ AI Exam Master: Assam Focus</h1>
        <p class="text-gray-500">Generate Real-Time Mock Tests for Competitive Exams.</p>
    </header>

    <!-- 1. Configuration/Setup Screen -->
    <div id="setup-screen" class="max-w-md mx-auto p-6 bg-white rounded-xl shadow-2xl transition-all duration-500">
        <h2 class="text-xl font-semibold mb-6 text-indigo-600">Exam Configuration</h2>
        
        <div class="space-y-4">
            <div>
                <label for="user-name" class="block text-sm font-medium text-gray-700">Your Name (for Certificate):</label>
                <input type="text" id="user-name" class="mt-1 block w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500" placeholder="Rouf Uddin Ahmed" required>
            </div>
            
            <div>
                <label for="exam-topic" class="block text-sm font-medium text-gray-700">Select Exam / Subject:</label>
                <select id="exam-topic" class="mt-1 block w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 appearance-none bg-white" required>
                    <option value="" disabled selected>Select Subject</option>
                    
                    <!-- Assam Competitive Exams -->
                    <optgroup label="Assam Competitive Exams">
                        <option value="APSC CCE (Combined Competitive Examination) General Studies">APSC CCE (General Studies)</option>
                        <option value="Assam Direct Recruitment ADRE Grade III & IV General Knowledge">Assam ADRE (GK & Reasoning)</option>
                        <option value="Assam Police SI/Constable General Knowledge and Current Affairs">Assam Police (GK & Current Affairs)</option>
                        <option value="DHS Assam (Directorate of Health Services) Technical Knowledge">DHS Assam (Health Sector Basics)</option>
                        <option value="Assam CEE (Combined Entrance Examination) Physics and Chemistry">Assam CEE (Physics/Chemistry)</option>
                        <option value="Assam General Knowledge and Culture">Assam General Knowledge & Culture</option>
                    </optgroup>

                    <!-- School Board Exams (SEBA/AHSEC) -->
                    <optgroup label="School Board Exams">
                        <option value="Assam HSLC (Class 10) General Science">HSLC (Class 10) General Science</option>
                        <option value="Assam HS (Class 12) Political Science">HS (Class 12) Political Science</option>
                        <option value="Assam HS (Class 12) Accountancy and Business Studies">HS (Class 12) Commerce</option>
                        <option value="Assam HS (Class 12) Physics and Mathematics">HS (Class 12) Science</option>
                    </optgroup>
                    
                    <!-- General Subjects -->
                    <optgroup label="General Subjects">
                        <option value="Advanced English Grammar and Vocabulary">Advanced English Grammar</option>
                        <option value="World History and Global Affairs">World History & Global Affairs</option>
                    </optgroup>
                </select>
            </div>

            <div>
                <label for="question-count" class="block text-sm font-medium text-gray-700">Number of Questions (MCQ):</label>
                <select id="question-count" class="mt-1 block w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 appearance-none bg-white" required>
                    <option value="10">10 Questions (Quick Test)</option>
                    <option value="25" selected>25 Questions (Standard Exam)</option>
                    <option value="50">50 Questions (Detailed Practice)</option>
                </select>
            </div>
        </div>

        <div id="error-message" class="text-red-500 text-sm mt-3 hidden">Please fill all required fields to start the exam.</div>
        
        <button onclick="startLoading()" class="btn-primary w-full mt-8 py-3 rounded-lg text-lg font-semibold shadow-xl">
            Start AI Generation & Exam ðŸš€
        </button>
    </div>

    <!-- 2. Loading Screen (while AI generates questions) -->
    <div id="loading-screen" class="hidden max-w-md mx-auto p-10 text-center bg-white rounded-xl shadow-2xl transition-all duration-500">
        <div class="flex justify-center mb-6">
            <div class="spinner"></div>
        </div>
        <p class="text-xl font-semibold text-indigo-600">AI is Generating Your Questions...</p>
        <p class="text-gray-500 mt-2">The Gemini AI is setting up your specialized exam. This may take a moment. </p>
        <p class="text-sm mt-4 text-red-500 font-medium">The screen will enter full-screen mode upon starting. Cheating is not permitted!</p>
    </div>

    <!-- 3. Exam Screen -->
    <div id="exam-screen" class="hidden flex-grow flex flex-col justify-center max-w-2xl mx-auto w-full p-4 bg-white rounded-xl shadow-2xl">
        <div class="bg-indigo-100 p-3 rounded-lg flex justify-between items-center mb-6">
            <p id="exam-progress" class="text-lg font-semibold text-indigo-700">Question 1 / 10</p>
            <p id="exam-topic-display" class="text-sm font-medium text-indigo-600 truncate"></p>
        </div>

        <div id="question-container" class="min-h-[150px] mb-6">
            <p id="current-question" class="text-2xl font-bold text-gray-800 mb-6 leading-relaxed">
                <!-- Question will be inserted here -->
            </p>

            <div id="options-container" class="space-y-3">
                <!-- Options will be inserted here -->
            </div>
        </div>

        <button onclick="nextQuestion()" id="next-btn" class="btn-primary w-full py-3 rounded-lg text-lg font-semibold transition-transform">
            Next Question
        </button>
    </div>

    <!-- 4. Certificate Screen -->
    <div id="certificate-screen" class="hidden max-w-4xl mx-auto p-4 flex-grow w-full">
        <div class="certificate">
            <p class="text-xl text-yellow-600 font-bold mb-3">CERTIFICATE OF ACHIEVEMENT</p>
            <h1 class="cert-header">AI EXAM MASTER</h1>
            
            <p class="text-lg text-gray-600">
                This certificate is proudly presented to
            </p>
            
            <p id="cert-user-name" class="cert-name"></p>
            
            <p class="text-2xl font-medium text-gray-700 mt-4">
                for Successfully Completing the Assessment
            </p>
            <p id="cert-exam-details" class="text-xl text-gray-600 mt-2"></p>

            <div class="mt-8 mb-8 border-t border-b border-gray-200 py-6">
                 <p class="text-2xl text-gray-800 font-bold">Achieved Score:</p>
                 <p id="cert-score-display" class="cert-score text-4xl"></p>
            </div>
            
            <div class="flex justify-around mt-10 text-center">
                <div>
                    <p class="border-b border-gray-500 w-32 mx-auto"></p>
                    <p class="text-sm font-medium mt-2 text-gray-700">Date: <span id="cert-date"></span></p>
                </div>
                <div>
                    <p class="border-b border-gray-500 w-32 mx-auto"></p>
                    <p class="text-sm font-medium mt-2 text-gray-700">AI Master</p>
                </div>
            </div>

            <p class="cert-footer">
                Powered by Google Gemini AI & Developed with Pride by The Digital Sync (Credit: Rouf Uddin Ahmed).
            </p>
             <div class="mt-4 text-xs space-x-4">
                <a href="https://youtube.com/@fearlesshacker" target="_blank" class="text-indigo-500 hover:underline">YouTube</a>
                <a href="https://thedigitsync.blogspot.com/" target="_blank" class="text-indigo-500 hover:underline">Website</a>
                <a href="https://instagram.com/thedigitsync" target="_blank" class="text-indigo-500 hover:underline">Instagram</a>
            </div>
        </div>

        <div class="max-w-4xl mx-auto text-center mt-6">
             <button onclick="window.location.reload()" class="btn-primary py-2 px-6 rounded-lg font-semibold">
                Start New Exam
            </button>
        </div>
    </div>

    <!-- Message Box for non-alert messages -->
    <div id="message-box" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-[10000]">
        <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full text-center">
            <p id="message-text" class="text-lg font-semibold text-gray-700 mb-4"></p>
            <button onclick="hideMessage()" class="btn-primary py-2 px-6 rounded-lg font-medium">OK</button>
        </div>
    </div>

</div>

<script>
    // Global variables
    let questions = [];
    let currentQuestionIndex = 0;
    let score = 0;
    let userName = '';
    let examTopic = '';
    let questionCount = 0;
    let selectedAnswer = null;

    // --- User-Provided API Key ---
    // NOTE: This key is being used directly as requested, but it MUST be complete and valid 
    // for the app to function outside of the Canvas environment.
    const apiKey = "AIzaSyCmPT4_hcAE8EzlH0rFN2cEyycb3--Thrw"; // WARNING: This key is likely incomplete/invalid.
    // ----------------------------
    
    // --- Utility Functions ---

    function showMessage(text) {
        document.getElementById('message-text').textContent = text;
        document.getElementById('message-box').classList.remove('hidden');
        document.getElementById('message-box').classList.add('flex');
    }

    function hideMessage() {
        document.getElementById('message-box').classList.add('hidden');
        document.getElementById('message-box').classList.remove('flex');
    }

    // Function to handle exponential backoff for API calls
    async function fetchWithRetry(url, options, maxRetries = 3) {
        let lastError = null;
        for (let i = 0; i < maxRetries; i++) {
            try {
                const response = await fetch(url, options);
                if (!response.ok) {
                    // Log the exact error for debugging by the user
                    console.error(`Attempt ${i + 1} received HTTP status: ${response.status}`);
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response;
            } catch (error) {
                lastError = error;
                const delay = Math.pow(2, i) * 1000;
                console.warn(`Fetch attempt ${i + 1} failed. Retrying in ${delay / 1000}s...`);
                await new Promise(resolve => setTimeout(resolve, delay));
            }
        }
        throw new Error(`Failed to fetch after ${maxRetries} attempts. Last error: ${lastError.message}`);
    }


    // --- Core Logic ---

    function startLoading() {
        userName = document.getElementById('user-name').value.trim();
        examTopic = document.getElementById('exam-topic').value;
        questionCount = parseInt(document.getElementById('question-count').value);

        if (!userName || !examTopic || !questionCount) {
            document.getElementById('error-message').classList.remove('hidden');
            return;
        }
        
        // Basic check for the (likely incomplete) API key
        if (apiKey === "AIzaSyCmPT4_hcAE8EzlH0rFN2cEyycb3--Thrw") {
             console.warn("Using potentially incomplete API Key. Expecting failure if not deployed in Canvas runtime.");
        }


        document.getElementById('error-message').classList.add('hidden');
        document.getElementById('setup-screen').classList.add('hidden');
        document.getElementById('loading-screen').classList.remove('hidden');

        // Start fetching questions from AI
        generateQuestions();
    }

    function enterFullScreen() {
        const element = document.documentElement;
        if (element.requestFullscreen) {
            element.requestFullscreen();
        } else if (element.mozRequestFullScreen) { /* Firefox */
            element.mozRequestFullScreen();
        } else if (element.webkitRequestFullscreen) { /* Chrome, Safari and Opera */
            element.webkitRequestFullscreen();
        } else if (element.msRequestFullscreen) { /* IE/Edge */
            element.msRequestFullscreen();
        }
    }

    async function generateQuestions() {
        // Use the user-provided API key here.
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

        const systemPrompt = `You are an expert educational content generator. Your task is to create ${questionCount} multiple-choice questions (MCQs) for an exam on the subject: "${examTopic}". The output MUST be a JSON array of objects following the provided schema. Ensure each question has exactly 4 options (A, B, C, D) and a single correct answer. Questions must be in professional English.`;
        
        const userQuery = `Generate ${questionCount} multiple-choice questions on the topic: ${examTopic} for a professional assessment. Focus on the specified Indian/Assam exam standards if mentioned.`;

        const payload = {
            contents: [{ parts: [{ text: userQuery }] }],
            systemInstruction: { parts: [{ text: systemPrompt }] },
            generationConfig: {
                responseMimeType: "application/json",
                responseSchema: {
                    type: "ARRAY",
                    items: {
                        type: "OBJECT",
                        properties: {
                            "question": { "type": "STRING", "description": "The question text." },
                            "options": {
                                "type": "OBJECT",
                                "properties": {
                                    "A": { "type": "STRING" },
                                    "B": { "type": "STRING" },
                                    "C": { "type": "STRING" },
                                    "D": { "type": "STRING" }
                                },
                                "propertyOrdering": ["A", "B", "C", "D"],
                                "description": "The four options for the MCQ."
                            },
                            "correctAnswer": { "type": "STRING", "description": "The key of the correct option: A, B, C, or D" }
                        },
                        "required": ["question", "options", "correctAnswer"]
                    }
                }
            }
        };

        const options = {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        };

        try {
            const response = await fetchWithRetry(apiUrl, options);
            const result = await response.json();

            if (result.candidates && result.candidates.length > 0) {
                const jsonText = result.candidates[0].content.parts[0].text;
                questions = JSON.parse(jsonText);
                
                if (questions.length === 0) {
                    throw new Error("AI could not generate questions. Try a different topic.");
                }

                // Questions generated successfully, start the exam
                document.getElementById('loading-screen').classList.add('hidden');
                document.getElementById('exam-screen').classList.remove('hidden');
                
                // Request full screen as anti-cheating measure
                enterFullScreen();
                
                displayQuestion();

            } else {
                throw new Error("AI response format error or content missing.");
            }

        } catch (error) {
            console.error("Gemini API Error:", error);
            document.getElementById('loading-screen').classList.add('hidden');
            document.getElementById('setup-screen').classList.remove('hidden');
            showMessage(`Fatal Error: Question generation failed. This key might be incomplete or invalid, or your host is blocking the call. Error: ${error.message}`);
        }
    }

    function displayQuestion() {
        if (currentQuestionIndex >= questions.length) {
            finishExam();
            return;
        }

        selectedAnswer = null; // Reset selection for new question
        const qData = questions[currentQuestionIndex];
        const questionNumber = currentQuestionIndex + 1;

        document.getElementById('exam-progress').textContent = `Question ${questionNumber} of ${questions.length}`;
        document.getElementById('exam-topic-display').textContent = `Topic: ${examTopic}`;
        document.getElementById('current-question').textContent = `${questionNumber}. ${qData.question}`;

        const optionsContainer = document.getElementById('options-container');
        optionsContainer.innerHTML = ''; // Clear previous options

        const optionKeys = ['A', 'B', 'C', 'D'];
        optionKeys.forEach(key => {
            const optionText = qData.options[key];
            
            const optionDiv = document.createElement('div');
            optionDiv.className = 'option-item p-4 bg-gray-100 hover:bg-indigo-100 rounded-lg cursor-pointer transition-colors border border-gray-200 shadow-sm';
            optionDiv.innerHTML = `<span class="font-bold text-indigo-700">${key}.</span> ${optionText}`;
            optionDiv.dataset.key = key;

            optionDiv.onclick = function() {
                // Remove selected class from all options
                document.querySelectorAll('.option-item').forEach(item => {
                    item.classList.remove('bg-indigo-600', 'text-white', 'scale-105');
                    item.classList.add('bg-gray-100', 'hover:bg-indigo-100');
                    item.querySelector('span').classList.remove('text-white');
                    item.querySelector('span').classList.add('text-indigo-700');
                });
                
                // Add selected class to the current option
                optionDiv.classList.add('bg-indigo-600', 'text-white', 'scale-105');
                optionDiv.classList.remove('bg-gray-100', 'hover:bg-indigo-100');
                optionDiv.querySelector('span').classList.remove('text-indigo-700');
                optionDiv.querySelector('span').classList.add('text-white');
                
                selectedAnswer = key;
                document.getElementById('next-btn').disabled = false;
            };

            optionsContainer.appendChild(optionDiv);
        });
        
        document.getElementById('next-btn').textContent = (questionNumber === questions.length) ? 'Finish Exam' : 'Next Question';
        document.getElementById('next-btn').disabled = true; // Disable until an answer is selected
    }

    function nextQuestion() {
        if (!selectedAnswer) {
            showMessage("Please select an answer before proceeding.");
            return;
        }

        const qData = questions[currentQuestionIndex];
        if (selectedAnswer === qData.correctAnswer) {
            score++;
        }

        currentQuestionIndex++;
        displayQuestion();
    }

    function finishExam() {
        // Exit Full Screen
        if (document.exitFullscreen) {
            document.exitFullscreen();
        } else if (document.mozCancelFullScreen) { /* Firefox */
            document.mozCancelFullScreen();
        } else if (document.webkitExitFullscreen) { /* Chrome, Safari and Opera */
            document.webkitExitFullscreen();
        } else if (document.msExitFullscreen) { /* IE/Edge */
            document.msExitFullscreen();
        }

        document.getElementById('exam-screen').classList.add('hidden');
        document.getElementById('certificate-screen').classList.remove('hidden');
        
        generateCertificate();
    }

    function generateCertificate() {
        const percentage = (score / questions.length) * 100;
        const resultText = `${score} out of ${questions.length} (${percentage.toFixed(2)}%)`;
        const date = new Date().toLocaleDateString('en-IN', {
            day: 'numeric', year: 'numeric', month: 'long'
        });

        document.getElementById('cert-user-name').textContent = userName;
        document.getElementById('cert-exam-details').textContent = `AI-Generated Assessment on ${examTopic}.`;
        document.getElementById('cert-score-display').textContent = resultText;
        document.getElementById('cert-date').textContent = date;
    }

    // Initial check on load
    document.addEventListener('DOMContentLoaded', () => {
        console.log("AI Exam App Loaded. Ready for setup.");
    });
</script>

</body>
</html>

